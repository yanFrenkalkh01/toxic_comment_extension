# YouTube Comment Toxicity Filter Extension

This project consists of two main parts:

1.  A **FastAPI backend** that uses a pre-trained LSTM model (TensorFlow/Keras) to predict the toxicity of text.
2.  A **Firefox browser extension** that captures YouTube comments, sends them to the FastAPI backend for analysis, and replaces comments deemed toxic with "[Toxic]".

## Prerequisites

Before you begin, ensure you have the following installed:

* **Python:** Version 3.8 or higher. (Required for the FastAPI backend)
* **pip:** Python package installer. (Usually comes with Python)
* **Node.js and npm:** (Required for building the browser extension)
    * Node.js: Version 16.x or higher recommended.
    * npm: Usually comes with Node.js.
* **Firefox Browser:** For installing and testing the extension.
* **Git:** (Optional, for cloning if the project is in a Git repository)

## Project Structure
toxic_comment_filter/
├── api/                            # Contains the FastAPI application
│   ├── main.py                     # FastAPI application code
│   ├── requirements.txt            # Python dependencies
│   ├── toxic_comment_lstm_final.h5 # Trained Keras model
│   └── tokenizer.json              # Keras tokenizer
│   └── venv/                       # Python virtual environment (created by you)
│
└── browser_extension/              # Contains the Firefox extension
    ├── src/
    │   └── youtube.js              # Content script logic
    ├── dist/                       # Bundled extension files (generated by Webpack)
    ├── manifest.json
    ├── package.json
    ├── package-lock.json
    ├── webpack.config.cjs


## I. Backend (FastAPI) Setup

1.  **Navigate to Backend Directory:**
    Open your terminal and change to the directory where you'll keep the backend files.

    ```bash
    cd path/to/your/project/backend_api
    ```

2.  **Create and Activate Python Virtual Environment:**
    It's highly recommended to use a virtual environment to manage Python dependencies.

    ```bash
    python -m venv venv
    ```
    Activate the environment:
    * On macOS and Linux:
        ```bash
        source venv/bin/activate
        ```
    * On Windows:
        ```bash
        .\venv\Scripts\activate
        ```
    Your terminal prompt should now indicate that you are in the virtual environment (`(venv) ...`).

3.  **Place Model and Tokenizer Files:**
    Ensure your pre-trained Keras model (`toxic_comment_lstm_final.h5`) and your tokenizer file (`tokenizer.json`) are placed directly inside this `backend_api/` directory (or adjust the paths in `main.py` if they are located elsewhere).

4.  **Install Python Dependencies:**
    Create a `requirements.txt` file (if you haven't already from previous steps) in the `api/` directory with the following content:

    ```text
    fastapi>=0.100.0
    uvicorn[standard]>=0.20.0
    tensorflow>=2.10.0
    numpy>=1.20.0
    nltk>=3.6.0
    ```
    Then, install these dependencies:
    ```bash
    pip install -r requirements.txt
    ```
    *(Note: The `main.py` script will attempt to download NLTK's `wordnet` and `stopwords` resources on its first run if they are not found.)*

5.  **Run the FastAPI Server:**
    Make sure your `main.py` file (containing the FastAPI application code provided in previous steps) is in the `api/` directory.
    Start the Uvicorn server:
    ```bash
    uvicorn main:app --reload --host 0.0.0.0 --port 8000
    ```
    * `--reload`: The server will automatically restart if you make changes to `main.py`.
    * `--host 0.0.0.0`: Makes the server accessible from your local network.
    * `--port 8000`: The server will listen on port 8000.

    You should see output indicating the server is running, for example:
    `INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)`
    You can test if it's working by opening `http://localhost:8000/` in your browser. You should see `{"message":"Toxic Comment Detection API is running."}`.

## II. Frontend (Browser Extension) Setup

1.  **Navigate to Extension Directory:**
    Open a new terminal window or tab (keep the FastAPI server running in the other one).
    Change to the directory containing your browser extension files (`browser_extension/`).

    ```bash
    cd path/to/your/project/browser_extension
    ```

2.  **Install Node.js Dependencies:**
    If you have a `package.json` file (as provided in previous steps), install the necessary Node.js packages:
    ```bash
    npm install
    ```

3.  **Build the Extension:**
    Use the build script defined in your `package.json` (which typically runs Webpack):
    ```bash
    npm run build
    ```
    This command will bundle your JavaScript files (like `src/youtube.js`) and output them into the `dist/` folder.

4.  **Configure API Endpoint in Extension:**
    * Open `browser_extension/src/youtube.js`.
    * Find the line: `const API_ENDPOINT = 'http://localhost:8000/process_text';`
    * Ensure this URL matches where your FastAPI server is running. If your backend is on a different machine or port, update this URL accordingly.

5.  **Configure Host Permissions in Manifest:**
    * Open `browser_extension/manifest.json`.
    * Locate the `host_permissions` section.
    * Ensure it includes the URL of your FastAPI server. For a local server, it should have:
        ```json
        "host_permissions": [
          "*://*[.youtube.com/](https://.youtube.com/)*",
          "http://localhost:8000/*"
        ],
        ```
    * If your API server is on a different domain/port, update `http://localhost:8000/*` accordingly (`"*://your-api-domain.com/*"`).

6.  **Load the Extension in Firefox:**
    * Open Firefox.
    * Type `about:debugging` in the address bar and press Enter.
    * Click on "This Firefox" in the left sidebar.
    * Click the "Load Temporary Add-on..." button.
    * Navigate to your `browser_extension/` directory and select the `manifest.json` file.

    The extension should now be loaded. You might see its icon (if you have one defined) in the Firefox toolbar.

## III. Usage

1.  **Ensure Backend is Running:** Your FastAPI server (started with `uvicorn main:app ...`) must be running.
2.  **Ensure Extension is Loaded:** The browser extension should be loaded in Firefox.
3.  **Navigate to YouTube:** Open a YouTube video page that has comments.
4.  **Observe:**
    * As comments load on the YouTube page, the extension's content script (`youtube.js`) will:
        * Temporarily replace the comment text with an empty string (or the `PLACEHOLDER_TEXT` you defined).
        * Send the original comment text to your FastAPI backend (`http://localhost:8000/process_text`).
        * Wait for the backend to process the text and send a response.
        * If the backend determines the comment's toxicity score is above the threshold (0.5), it will replace the comment with `[Toxic]`.
        * Otherwise, it will display the original comment text.
5.  **Check Consoles for Debugging:**
    * **Browser Console:** Open Firefox Developer Tools (Ctrl+Shift+I or Cmd+Opt+I) and check the "Console" tab for messages from the content script (e.g., API request logs, errors).
    * **FastAPI Server Terminal:** Check the terminal where Uvicorn is running for logs from the backend, including received text, prediction probabilities, and any server-side errors.

## IV. Troubleshooting Common Issues

* **CORS Errors ("CORS Missing Allow Origin", "Cross-Origin Request Blocked"):**
    * This means the FastAPI server isn't allowing requests from your browser extension.
    * **Solution 1 (Debugging):** In `backend_api/main.py`, temporarily set `allow_origins=["*"]` in the `CORSMiddleware` setup to allow all origins. Restart Uvicorn. If this works, the issue is with your specific origin patterns.
    * **Solution 2 (Precise Origin):** If `allow_origins=["*"]` works, find your extension's exact origin. In Firefox, load the extension, go to a YouTube page, open the Network tab in dev tools, find a failed request to your API, and look at the `Origin` request header (e.g., `moz-extension://<some-uuid>`). Add this specific origin or a regex like `allow_origin_regex=r"moz-extension://[0-9a-fA-F\\-]+"` to `CORSMiddleware` in `main.py`.
    * Ensure `host_permissions` in `manifest.json` correctly includes your API's URL.

* **API Not Reachable (NetworkError when attempting to fetch resource):**
    * Ensure your FastAPI server is running and accessible at the URL specified in `API_ENDPOINT` in `youtube.js`.
    * Check if a firewall is blocking connections to port 8000.
    * If running the API on `0.0.0.0`, try accessing it via `http://<your-local-ip-address>:8000/` from the same machine to ensure it's bound correctly.

* **Model or Tokenizer Not Loading (Backend):**
    * Check the FastAPI server terminal for error messages like "Model file ... not found" or "Error loading LSTM model...".
    * Ensure `toxic_comment_lstm_final.h5` and `tokenizer.json` are in the correct directory relative to `main.py`.
    * Verify that your TensorFlow and Keras versions are compatible with the saved model.

* **Extension Not Working / No Changes on YouTube:**
    * Check the browser console for errors.
    * Ensure the extension is enabled in `about:addons`.
    * Verify that `content_scripts.matches` in `manifest.json` correctly targets YouTube pages (`"*://*.youtube.com/*"`).

This guide should help you get the project up and running!